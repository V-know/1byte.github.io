<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Gavin Wei" />



<meta name="description" content="Graphite是一款企业级的监控工具，其采用Django框架，可以运行在廉价的硬件资源之上。Graphite采用简单的文本协议和绘图功能可以方便地使用在任何操作系统上。本文将以Ubuntu 14.04为系统环境，就Graphite与Grafana的安装与协作做详细介绍。 Before You Begin / 热身准备1. Familiarize yourself with our Getting">
<meta name="keywords" content="graphite,grafana,Monitoring,ubuntu">
<meta property="og:type" content="article">
<meta property="og:title" content="Deploy Graphite with Grafana on Ubuntu 14.04(Part Ⅰ)">
<meta property="og:url" content="http://1byte.pro/Monitoring/graphite.html">
<meta property="og:site_name" content="Just 1 Byte">
<meta property="og:description" content="Graphite是一款企业级的监控工具，其采用Django框架，可以运行在廉价的硬件资源之上。Graphite采用简单的文本协议和绘图功能可以方便地使用在任何操作系统上。本文将以Ubuntu 14.04为系统环境，就Graphite与Grafana的安装与协作做详细介绍。 Before You Begin / 热身准备1. Familiarize yourself with our Getting">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://www.linode.com/docs/assets/graphite_landing_page.png">
<meta property="og:image" content="https://www.linode.com/docs/assets/graphite_test_metric.png">
<meta property="og:updated_time" content="2018-08-28T09:41:44.161Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Deploy Graphite with Grafana on Ubuntu 14.04(Part Ⅰ)">
<meta name="twitter:description" content="Graphite是一款企业级的监控工具，其采用Django框架，可以运行在廉价的硬件资源之上。Graphite采用简单的文本协议和绘图功能可以方便地使用在任何操作系统上。本文将以Ubuntu 14.04为系统环境，就Graphite与Grafana的安装与协作做详细介绍。 Before You Begin / 热身准备1. Familiarize yourself with our Getting">
<meta name="twitter:image" content="https://www.linode.com/docs/assets/graphite_landing_page.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">




    <link rel="shortcut icon" href="/img/favicon.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-big-counter.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Deploy Graphite with Grafana on Ubuntu 14.04(Part Ⅰ) | Just 1 Byte</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>



    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b6bfb7348dc08eb"></script>




</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/head.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Gavin Wei</a></h1>
        </hgroup>

        
        <p class="header-subtitle">○|||||||○</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">博客首页</a></li>
                        
                            <li><a href="/about/">九评博主</a></li>
                        
                            <li><a href="/archives/">文章归档</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Coding" href="https://github.com/v-know" title="Coding"></a>
                            
                                <a class="fa 知乎" href="https://www.zhihu.com/people/unamed-mr" title="知乎"></a>
                            
                                <a class="fa 新浪微博" href="http://weibo.com/178go" title="新浪微博"></a>
                            
                                <a class="fa Twitter" href="http://twitter.com/mrunamed" title="Twitter"></a>
                            
                                <a class="fa 简书" href="http://www.jianshu.com/users/7a890139a00e/latest_articles" title="简书"></a>
                            
                                <a class="fa Quora" href="https://www.quora.com/profile/Gavin-Hill-5" title="Quora"></a>
                            
                                <a class="fa CSDN" href="mailto:none@canstop.me" title="CSDN"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chromium/">Chromium</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DIND/">DIND</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Exception/">Exception</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flume/">Flume</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FreeIPA/">FreeIPA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gitlab/">Gitlab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Issue/">Issue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/">Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jira/">Jira</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/">Kafka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Monitoring/">Monitoring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scala/">Scala</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Selenium/">Selenium</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shame/">Shame</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark/">Spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Troubleshooting/">Troubleshooting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/V/">V</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/collectd/">collectd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/container/">container</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fabfile/">fabfile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fabric/">fabric</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grafana/">grafana</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/graphite/">graphite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/image/">image</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jira/">jira</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lorote/">lorote</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/percona/">percona</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/seyren/">seyren</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ss5/">ss5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工作笔记/">工作笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/性能优化/">性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/日志切割/">日志切割</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/红芯浏览器/">红芯浏览器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/雕虫小技/">雕虫小技</a></li></ul>
                    </div>
                </section>
                
                
                

                
                
                <section class="switch-part switch-part3">
                
                    <div id="js-aboutme">爱单车、爱Linux、学摄影 《Ansible权威指南》作者</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Gavin Wei</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/head.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Gavin Wei</a></h1>
            </hgroup>
            
            <p class="header-subtitle">○|||||||○</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">博客首页</a></li>
                
                    <li><a href="/about/">九评博主</a></li>
                
                    <li><a href="/archives/">文章归档</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Coding" target="_blank" href="https://github.com/v-know" title="Coding"></a>
                            
                                <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/unamed-mr" title="知乎"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/178go" title="新浪微博"></a>
                            
                                <a class="fa Twitter" target="_blank" href="http://twitter.com/mrunamed" title="Twitter"></a>
                            
                                <a class="fa 简书" target="_blank" href="http://www.jianshu.com/users/7a890139a00e/latest_articles" title="简书"></a>
                            
                                <a class="fa Quora" target="_blank" href="https://www.quora.com/profile/Gavin-Hill-5" title="Quora"></a>
                            
                                <a class="fa CSDN" target="_blank" href="mailto:none@canstop.me" title="CSDN"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-graphite" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Monitoring/graphite.html" class="article-date">
      <time datetime="2016-09-13T09:22:38.000Z" itemprop="datePublished">2016-09-13</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Deploy Graphite with Grafana on Ubuntu 14.04(Part Ⅰ)
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Monitoring/">Monitoring</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Monitoring/">Monitoring</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/grafana/">grafana</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/graphite/">graphite</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ubuntu/">ubuntu</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><a href="http://graphite.readthedocs.org/en/latest/index.html" target="_blank" rel="noopener">Graphite</a>是一款企业级的监控工具，其采用Django框架，可以运行在廉价的硬件资源之上。Graphite采用简单的文本协议和绘图功能可以方便地使用在任何操作系统上。本文将以Ubuntu 14.04为系统环境，就Graphite与<a href="http://graphite.readthedocs.org/en/latest/index.html" target="_blank" rel="noopener">Grafana</a>的安装与协作做详细介绍。</p>
<h2 id="Before-You-Begin-热身准备"><a href="#Before-You-Begin-热身准备" class="headerlink" title="Before You Begin / 热身准备"></a>Before You Begin / 热身准备</h2><p><strong>1.</strong> Familiarize yourself with our Getting Started guide and complete the steps for setting your Linode’s hostname and timezone.<br>本文原文来自Linode官网，所以会看到Linode字样，不用理会，把它当成你的主机的就可以了<br><a id="more"></a><br><strong>2.</strong> This guide will use sudo wherever possible from an example account named graphite. Complete the sections of our Securing Your Server guide to create the graphite user, harden SSH access, remove unnecessary network services and set up a firewall. You may need to create additional firewall rules for your specific application.<br>本文默认使用普通用户进行安装部署<br><strong>3.</strong> Update your system:<br>开始前，系统需要做一下更新（非必须）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; sudo apt-get upgrade</span><br></pre></td></tr></table></figure></p>
<h2 id="Install-Apache-Python-Tools-and-Graphite"><a href="#Install-Apache-Python-Tools-and-Graphite" class="headerlink" title="Install Apache, Python Tools and Graphite"></a>Install Apache, Python Tools and Graphite</h2><p>Install the system packages required for working with Graphite:<br>安装Graphite本身及其依赖的一些工具<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install build-essential graphite-web graphite-carbon python-dev apache2 libapache2-mod-wsgi libpq-dev python-psycopg2</span><br></pre></td></tr></table></figure></p>
<p>During the installation of <code>graphite-carbon</code>, you will be asked if you want to remove the whisper database files should you ever uninstall Graphite. Answer <strong>No</strong> to this prompt. You can always remove the files later (which are located in <code>/var/lib/graphite/whisper</code>).<br>安装<code>graphite-carbon</code>的过程中，会提示你是要删除whisper数据库文件，回答No就好，我们可以后面随时手动删除这些文件；如果是新主机，回答Yes也没有问题。</p>
<h2 id="Configure-Carbon"><a href="#Configure-Carbon" class="headerlink" title="Configure Carbon"></a>Configure Carbon</h2><p><strong>1.</strong> Configure the retention rate for test metrics by adding a <code>[test]</code> block to Carbon’s <code>storage-schemas.conf</code> file. <em>This step is given for testing purposes only and can be safely skipped if you have no use to generate test metrics.</em></p>
<p>The retention times given below will save data every 5 seconds for 3 hours, and a separate set of data from that aggregated sample every 1 minute for 1 day.<br>这个文件设置了Graphie接收数据的频率和保存时间。我们向其中添加<code>[test]</code>字段用于测试。</p>
<p><em>File excerpt:</em> <strong>/etc/carbon/storage-schemas.conf</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[carbon]</span><br><span class="line">pattern = ^carbon\.</span><br><span class="line">retentions = 60:90d</span><br><span class="line"></span><br><span class="line">[test]</span><br><span class="line">pattern = ^test\.</span><br><span class="line">retentions = 5s:3h,1m:1d  #第一保存配置是，保存每5秒一次的数据3小时，第二保存配置是保存第分钟取一次的数据一天</span><br><span class="line"></span><br><span class="line">[default_1min_for_1day]</span><br><span class="line">pattern = .*</span><br><span class="line">retentions = 60s:1d</span><br></pre></td></tr></table></figure></p>
<p>For more information on how to configure Carbon storage, see the section <a href="http://graphite.readthedocs.org/en/latest/config-carbon.html#storage-schemas-conf" target="_blank" rel="noopener">torage-schemas.conf</a> in Graphite’s documentation.</p>
<p><strong>2.</strong> Copy the default aggregation configuration to <code>/etc/carbon</code> so we can configure our own settings:<br>产生文件<code>storage-aggregation.conf</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /usr/share/doc/graphite-carbon/examples/storage-aggregation.conf.example /etc/carbon/storage-aggregation.conf</span><br></pre></td></tr></table></figure></p>
<p><code>storage-aggregation.conf</code> describes aggregation policies Carbon uses to produce less detailed metrics, such as the 1m:1d retention in the [test] block added above. By default, only the average metric value is taken, which will result in data loss when, for example, you need maximum and minimum values. For this reason, <code>[min]</code>,<code>[max]</code> and <code>[sum]</code> sections are found in the configuration file.<br>文件<code>storage-aggregation.conf</code>定义了Carbon聚合数据的策略</p>
<p><strong>3.</strong>Third, Enable Carbon’s cache to run on boot:<br>设置Carbon-cahce开机启动</p>
<p><em>File excerpt:</em> <strong>/etc/default/graphite-carbon</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CARBON_CACHE_ENABLED=true</span><br></pre></td></tr></table></figure></p>
<p>Start the Carbon cache service:<br>启动：Carbon cache<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service carbon-cache start</span><br></pre></td></tr></table></figure></p>
<h2 id="Install-and-Configure-PostgreSQL"><a href="#Install-and-Configure-PostgreSQL" class="headerlink" title="Install and Configure PostgreSQL"></a>Install and Configure PostgreSQL</h2><p>grephit-web依赖PosetgreSQL数据库<br><strong>1.</strong> Install PostgreSQL for the graphite-web application:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install postgresql</span><br></pre></td></tr></table></figure></p>
<p><strong>2.</strong> Change to the <code>postgres</code> user and create a database user for Graphite:<br>为Graphite创建数据库用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su - postgres</span><br><span class="line">createuser graphite --pwprompt</span><br></pre></td></tr></table></figure></p>
<p>You will be asked to provide a password for the new database user. After that, create the databases <code>graphite</code> and <code>grafana</code> with the system’s <code>graphite</code> user as the owner:<br>使用刚创建的用户<code>graphite</code>创建两个数据库：<code>graphite</code>和<code>grafana</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">createdb -O graphite graphite</span><br><span class="line">createdb -O graphite grafana</span><br></pre></td></tr></table></figure></p>
<p><strong>3.</strong> When finished configuring the PostgreSQL databases, change back to the graphite user:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su - graphite</span><br></pre></td></tr></table></figure></p>
<h2 id="Configure-Graphite"><a href="#Configure-Graphite" class="headerlink" title="Configure Graphite"></a>Configure Graphite</h2><p><strong>1.</strong> Update Graphite’s DATABASES dictionary definition with the settings for the PostgreSQL database created earlier:<br>配置Graphite使用刚才创建的数据库：<br><em>File excerpt:</em> <strong>/etc/graphite/local_settings.py</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">&apos;default&apos;: &#123;</span><br><span class="line">    &apos;NAME&apos;: &apos;graphite&apos;,</span><br><span class="line">    &apos;ENGINE&apos;: &apos;django.db.backends.postgresql_psycopg2&apos;,</span><br><span class="line">    &apos;USER&apos;: &apos;graphite&apos;,</span><br><span class="line">    &apos;PASSWORD&apos;: &apos;graphiteuserpassword&apos;,</span><br><span class="line">    &apos;HOST&apos;: &apos;127.0.0.1&apos;,</span><br><span class="line">    &apos;PORT&apos;: &apos;&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>2.</strong> Also add the following lines to the end of the file:<br>在文件尾部添加下面几项配置：<br><em>File excerpt:</em> <strong>/etc/graphite/local_settings.py</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">USE_REMOTE_USER_AUTHENTICATION = True</span><br><span class="line">TIME_ZONE = &apos;Your/Timezone&apos;</span><br><span class="line">SECRET_KEY = &apos;somelonganduniquesecretstring&apos;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>TIME_ZONE is your Linode’s time zone, which will be used in graphs. For possible values, run <code>timedatectl</code> or see the TZ column in <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank" rel="noopener">Wikipedia’s timezone database</a>.<code>timedatectl</code>命令可以用来获取当前主机的时区信息</li>
<li>SECRET_KEY is a long and unique string used as a salt when hashing passwords.一个用来哈希加密密码的随机字符串，越随机越好。</li>
</ul>
<p><strong>3.</strong> Initialize the database with:<br>初始化数据库：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo graphite-manage syncdb</span><br></pre></td></tr></table></figure></p>
<p><strong>4.</strong> Then answer the prompts to create a superuser account which will be used to access Graphite’s web interface.</p>
<h2 id="Configure-Apache-for-Graphite"><a href="#Configure-Apache-for-Graphite" class="headerlink" title="Configure Apache for Graphite"></a>Configure Apache for Graphite</h2><p>配置Apache用于web访问Graphite<br><strong>1.</strong> Copy Graphite’s Apache config template into Apache’s sites-available directory:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /usr/share/graphite-web/apache2-graphite.conf /etc/apache2/sites-available</span><br></pre></td></tr></table></figure></p>
<p><strong>2.</strong> Change Graphite’s port from 80 to 8080 (port 80 will be used for Grafana later).<br>使用8080端口来访问Graphite<br><em>File excerpt:</em> <strong>/etc/apache2/sites-available/apache2-graphite.conf</strong><br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:<span class="number">8080</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong>3.</strong> Make sure Apache is listening on port 8080. Add <code>Listen 8080</code> after <code>Listen 80</code> in <code>ports.conf</code>:<br>配置Apache监听8080端口：<br><em>File excerpt:</em> <strong>/etc/apache2/ports.conf</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Listen 80</span><br><span class="line">Listen 8080</span><br></pre></td></tr></table></figure></p>
<p><strong>4.</strong> Disable the default Apache site to avoid conflicts:<br>关闭默认页面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo a2dissite 000-default</span><br></pre></td></tr></table></figure></p>
<p><strong>5.</strong> Enable Graphite’s virtual site:<br>开启Graphite虚拟站点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo a2ensite apache2-graphite</span><br></pre></td></tr></table></figure></p>
<p><strong>6.</strong> Reload Apache to apply the changes:<br>Reload Apache<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service apache2 reload</span><br></pre></td></tr></table></figure></p>
<p>Now you should be able to access Graphite by going to your Linode’s hostname or IP address using port 8080 in a web browser (ex: <code>example_domain.com:8080</code>). You’ll see the Graphite landing page as shown below:<br>现在可以通过访问所在主机的8080端口来查看Graphite页面了<br><img src="https://www.linode.com/docs/assets/graphite_landing_page.png" alt="Graphite landing page"></p>
<h2 id="Create-Sample-Data"><a href="#Create-Sample-Data" class="headerlink" title="Create Sample Data"></a>Create Sample Data</h2><p>生成测试数据<br><strong>1.</strong> Generate some test metrics with the following command:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i in 4 6 8 16 2; do echo &quot;test.count $i `date +%s`&quot; | nc -q0 127.0.0.1 2003; sleep 6; done</span><br></pre></td></tr></table></figure></p>
<p><strong>2.</strong> Wait for the command prompt to be returned. Refresh the page and you should see a new <code>test.count</code> metric in the tree on the left:<br><img src="https://www.linode.com/docs/assets/graphite_test_metric.png" alt="Graphite test metric"></p>
<p>This guide is published under a CC BY-ND 4.0 license.<br>The pure English Version: <a href="https://www.linode.com/docs/uptime/monitoring/deploy-graphite-with-grafana-on-ubuntu-14-04" target="_blank" rel="noopener">https://www.linode.com/docs/uptime/monitoring/deploy-graphite-with-grafana-on-ubuntu-14-04</a></p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/Monitoring/graphite.html">Deploy Graphite with Grafana on Ubuntu 14.04(Part Ⅰ)</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Gavin Wei</a></p>
        <p><span>发布时间:</span>2016-09-13, 09:22:38</p>
        <p><span>最后更新:</span>2018-08-28, 09:41:44</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/Monitoring/graphite.html" title="Deploy Graphite with Grafana on Ubuntu 14.04(Part Ⅰ)">http://1byte.pro/Monitoring/graphite.html</a>
            <span class="copy-path" data-clipboard-text="原文: http://1byte.pro/Monitoring/graphite.html　　作者: Gavin Wei" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/Monitoring/grafana.html">
                    Deploy Graphite with Grafana on Ubuntu 14.04 (Part Ⅱ)
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/Python/date-of-python.html">
                    Python日期自然月加减实操
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Before-You-Begin-热身准备"><span class="toc-number">1.</span> <span class="toc-text">Before You Begin / 热身准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Install-Apache-Python-Tools-and-Graphite"><span class="toc-number">2.</span> <span class="toc-text">Install Apache, Python Tools and Graphite</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configure-Carbon"><span class="toc-number">3.</span> <span class="toc-text">Configure Carbon</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Install-and-Configure-PostgreSQL"><span class="toc-number">4.</span> <span class="toc-text">Install and Configure PostgreSQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configure-Graphite"><span class="toc-number">5.</span> <span class="toc-text">Configure Graphite</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configure-Apache-for-Graphite"><span class="toc-number">6.</span> <span class="toc-text">Configure Apache for Graphite</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Create-Sample-Data"><span class="toc-number">7.</span> <span class="toc-text">Create Sample Data</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    

    
        <div class="addthis_sharing_toolbox"></div>
    
</div>







    
        <section id="comments">
    <style> aside.comment-bar { margin: auto 30px; }</style>
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function(){
            this.page.url = 'http://1byte.pro/Monitoring/graphite.html';
            this.page.identifier = 'Monitoring/graphite.html';
        };
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = '//cancellara.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        }
    </script>
    
    <aside class="comment-bar">
        <a href="javascript:void(0);">
            <i class="fa fa-commenting-o animated infinite pulse"></i>
            <i class="fa fa-spinner fa-pulse"></i>
            <span class="count-comment"></span>
        </a>
    </aside>
    <script>
        var $commentBar = $("#comments aside.comment-bar");
        var load$hide = function(){
            $commentBar.find("a > i").toggle();
            loadComment();
            $commentBar.fadeOut(800);
        }
        $commentBar.click(function(){
            load$hide();
        })
        $commentBar.children("a").hover(function(){
            load$hide();
        })
        if (window.location.hash === "#comments") {
            load$hide();
        }
    </script>

</section>


    <script id="dsq-count-scr" src="//cancellara.disqus.com/count.js" async></script>
    <span class="disqus-comment-count" data-disqus-identifier="Monitoring/graphite.html"></span>
    <span class="disqus-comment-count" data-disqus-url="http://1byte.pro/Monitoring/graphite.html"></span>
    <script>
        $(".disqus-comment-count").hide();
        var $disqusCount = $(".disqus-comment-count");
        $disqusCount.bind("DOMNodeInserted", function(e) {
            $(".count-comment").text(
                $(this).text().replace(/[^0-9]/ig,"")
            )
            DISQUSWIDGETS.getCount({reset: true});
        })
    </script>


    




    <div class="scroll" id="post-nav-button">
        
            <a href="/Monitoring/grafana.html" title="上一篇: Deploy Graphite with Grafana on Ubuntu 14.04 (Part Ⅱ)">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/Python/date-of-python.html" title="下一篇: Python日期自然月加减实操">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/BigData/foreach-forearchpartition.html">Spark性能优化之foreach与foreachPartition</a></li><li class="post-list-item"><a class="post-list-link" href="/Devops/kafka-flume.html">Kafka与Flume区别</a></li><li class="post-list-item"><a class="post-list-link" href="/Coding/scala-exception-handler.html">Scala异常获取一例</a></li><li class="post-list-item"><a class="post-list-link" href="/Opinions/fake-chrome.html">红芯浏览器下载</a></li><li class="post-list-item"><a class="post-list-link" href="/Issues/gitlab-trouble-shooting.html">Gitlab问题小结</a></li><li class="post-list-item"><a class="post-list-link" href="/Python/chromium-on-centos-for-selenium.html">无GUI的CentOS上使用Selenium+Chrome</a></li><li class="post-list-item"><a class="post-list-link" href="/Voice/v.html">V</a></li><li class="post-list-item"><a class="post-list-link" href="/Issues/jira-over-https.html">Nginx开启HTTPS反向代理访问Jira失败</a></li><li class="post-list-item"><a class="post-list-link" href="/Devops/install-freeipa-client.html">FreeIPA Client 端部署</a></li><li class="post-list-item"><a class="post-list-link" href="/Devops/install-freeipa-server-on-centos.html">FreeIPA Server 端部署</a></li><li class="post-list-item"><a class="post-list-link" href="/Monitoring/collectd.html">collectd</a></li><li class="post-list-item"><a class="post-list-link" href="/Monitoring/seyren.html">Deploy Seyren with Grafana on Ubuntu 14.04</a></li><li class="post-list-item"><a class="post-list-link" href="/Monitoring/grafana.html">Deploy Graphite with Grafana on Ubuntu 14.04 (Part Ⅱ)</a></li><li class="post-list-item"><a class="post-list-link" href="/Monitoring/graphite.html">Deploy Graphite with Grafana on Ubuntu 14.04(Part Ⅰ)</a></li><li class="post-list-item"><a class="post-list-link" href="/Python/date-of-python.html">Python日期自然月加减实操</a></li><li class="post-list-item"><a class="post-list-link" href="/Jenkins/jenkins.html">Jenkins Operation</a></li><li class="post-list-item"><a class="post-list-link" href="/Docker/install-jira-manully.html">Jira Manully Install</a></li><li class="post-list-item"><a class="post-list-link" href="/Docker/add-logrotate-to-percona-container.html">percona容器添加logrotate功能</a></li><li class="post-list-item"><a class="post-list-link" href="/Docker/compile-image.html">Percona容器部署</a></li><li class="post-list-item"><a class="post-list-link" href="/Docker/ss5.html">SS5 Installation</a></li><li class="post-list-item"><a class="post-list-link" href="/Docker/docker-deployment.html">Docker deployment</a></li><li class="post-list-item"><a class="post-list-link" href="/Docker/fabfile.html">vpnporxy 部署纪要</a></li></ul>




    <script>
        
    </script>

</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2018 Gavin Wei
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    
    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-123125086-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
             github: ".github-widget a", 
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>